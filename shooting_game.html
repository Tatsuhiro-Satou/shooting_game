<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="UTF-8"> 
		<title>Shooting game</title>
		<style>

			.centeredElement {
			  position: fixed; /* or absolute */
			  top: 50%;
			  left: 50%;
			  margin-top: -350px; /* got to be 50% of canvas height */
			  margin-left: -600px; /* got to be 50% of canvas width */
			}

			p { 
				font-family: "Times New Roman";
				border:1px solid #d3d3d3; 
				padding-left: 0;
			   	padding-right: 0;
			   	margin-left: auto;
			   	margin-right: auto; 
				display: block;
			   	width: 800px;
			}

		</style>
	</head>
	<body>
		<canvas id="screen" class="centeredElement" width="1200" height="700"></canvas>
		<p id="debug">...</p>

		<script>
			const CANVAS = document.getElementById('screen');
			const CONTEXT = CANVAS.getContext('2d');
			CONTEXT.font = "30px Arial";
			var NOW, LAST = timestamp();
			var COUNT = 0; // needs better name
			var FPS_COUNT = 0;
			var TOTAL_FRAMES = 0;
			var GLOBAL_TIMER = 0;

			var Keys = {
				UP: false,
				LEFT: false,
				RIGHT: false,
				DOWN: false
			};
			// console.log(); then go to debug in firefox

			document.getElementById("screen").style.backgroundColor = 'rgb(51, 171, 210)';

			window.onkeydown = function(e) {
				//e.preventDefault(); // Prevent the default action of keydown

				if (e.keyCode == 87)
					Keys.UP = true;
				else if (e.keyCode == 65)
					Keys.LEFT = true;
				else if (e.keyCode == 68)
					Keys.RIGHT = true;
				else if (e.keyCode == 83)
					Keys.DOWN = true;
				else if (e.keyCode == 32) // space
					PLAYER.fireMissile();
			}
			window.onkeyup = function(e) {
				//e.preventDefault();

				if (e.keyCode == 87)
					Keys.UP = false;
				else if (e.keyCode == 65)
					Keys.LEFT = false;
				else if (e.keyCode == 68)
					Keys.RIGHT = false;
				else if (e.keyCode == 83)
					Keys.DOWN = false;
			}

			/*
			   Player has a prototype object from which it inherits stuff
			   When instantiating from this class, a link is created to the original Player constructor class
			   Player is a prototype, the PLAYER var below inherits from the prototypeaPlayer has a prototype object from which it inherits stuffPlayer has a prototype object from which it inherits stuff

		    */
			function Player(initialX, initialY) { // constructor function and class (not object literal) 
				this.image = new Image(); 
				this.image.src = "resources/jet_player_sprite.png";
				this.width = 60;
				this.height = 60;
				this.x = initialX;
				this.y = initialY - this.height;
				this.speed = 5;
			}

			function Missile(initialX, initialY) {
				this.image = new Image(); 
				this.image.src = "resources/missile.png";
				this.width = 10;
				this.height = 23;
				this.x = initialX;
				this.y = initialY - this.height;
				this.speed = 5;
			}

			function EnemyJet(initialX, initialY) {
				this.image = new Image(); 
				this.image.src = "resources/jet_enemy_sprite.png";
				this.width = 60;
				this.height = 60;
				this.x = initialX;
				this.y = initialY - this.height;
				this.speed = 2;
			}

			Missile.prototype.draw = function() {
				CONTEXT.drawImage(this.image, this.x, this.y, this.width, this.height);
			};

			EnemyJet.prototype.draw = function() {
				CONTEXT.drawImage(this.image, this.x, this.y, this.width, this.height);
			};

			Player.prototype.draw = function() {
				CONTEXT.drawImage(this.image, this.x, this.y, this.width, this.height);
			};

			Player.prototype.getInfo = function() {
				return "x = " + this.x + ", y = " + this.y;
			};

			var ROCKET_AMMO = 4;
			let alternateMissileWingCount = 0;
			Player.prototype.fireMissile = function() {


				if (ROCKET_AMMO > 0) {
					var MISSILE = new Missile((CANVAS.width / 2), CANVAS.height);
					if (alternateMissileWingCount == 0) {
						MISSILE.x = PLAYER.x;
						alternateMissileWingCount = 1;
					} else if (alternateMissileWingCount == 1) {
						MISSILE.x = PLAYER.x + 50;
						alternateMissileWingCount = 0;
					}

					MISSILE.y = PLAYER.y + 28;
					MISSILES.push(MISSILE);
					ROCKET_AMMO -= 1;
				}
			};

			var PLAYER = new Player((CANVAS.width / 2), CANVAS.height);
			var MISSILES = [];
			var ENEMY_JETS = [];
			var TILE_WATER = new Image();
			TILE_WATER.src = "resources/tile_water.png";

			window.onload = function() {
				init();
			}

			function init() {
				window.requestAnimationFrame(frame);
				CONTEXT.fillText("fps:", 2, 25);
				drawTileArray();
			}

			function drawTileArray() {
				let maxHorizontalTiles = CANVAS.width / 100;
				let maxVerticalTiles = CANVAS.height / 100;
				let maxTiles = maxVerticalTiles * maxHorizontalTiles;

				for (let i = 0; i < maxVerticalTiles; i++) {
					for (let a = 0; a < maxHorizontalTiles; a++) {
						CONTEXT.drawImage(TILE_WATER, a * 100, i * 100, 100, 100);
					}
				}

			}

			function frame() {
				NOW = timestamp();
				var dt  = NOW - LAST;
				LAST = NOW;
				update(dt);
				render(dt);
				window.requestAnimationFrame(frame);
			}

			function timestamp() {
				return window.performance && window.performance.now ? window.performance.now() : new Date().getTime();
			}

			function update(dt) {
				GLOBAL_TIMER += dt;
			 	FPS_COUNT += dt;
				COUNT += dt;

				for (let i = 0; i < MISSILES.length; i++) {
					/*
					for (let a = 0; a < ENEMY_JETS.length; a++) {
							document.getElementById("debug").innerHTML = MISSILES[i].y + ", " + ENEMY_JETS[a].y ;
							alert(MISSILES[i].y + ", " + ENEMY_JETS[a].y);
						if (collision(MISSILES[i].x, MISSILES[i].y, ENEMY_JETS[a].x, ENEMY_JETS[a].y, ENEMY_JETS[a].width, ENEMY_JETS[a].height)) {
							alert("BOOM");
						}
					}
					*/
					if (MISSILES[i].y < 0) {
						MISSILES.splice(i, 1);
					}
				}

				if (ROCKET_AMMO == 0) {
					if (MISSILES.length == 0) {
						ROCKET_AMMO = 4;
					}
				}

				updateEnemies(dt);
				move();
			}

			function collision (missileX, missileY, enemyX, enemyY, width, height) {
				alert("x: " + x + " and x + width = " + (x + width)); 
				alert("y: " + y + " and y + height= " + (y + height)); 
			}

			function updateEnemies (dt) {
				if (ENEMY_JETS.length != 0) {
					for (let i = 0; i < ENEMY_JETS.length; i++) {
						ENEMY_JETS[i].y += ENEMY_JETS[i].speed;
					}
				}
				if ((GLOBAL_TIMER > 1000) && (ENEMY_JETS.length == 0)) {
					var enemy_jet = new EnemyJet((CANVAS.width / 2), CANVAS.height);
					enemy_jet.x = 600;
					enemy_jet.y = -100;
					ENEMY_JETS.push(enemy_jet);
				}
			}

			var TEMP_TOTAL_FRAMERATE = 0;
			function render(dt) {
				if ((COUNT >= 0.06) ) {
					drawTileArray();
					CONTEXT.fillText("FPS: " + TEMP_TOTAL_FRAMERATE, 2,25);
					if (ROCKET_AMMO != 0) {
						CONTEXT.fillText("ROCKETS: " + ROCKET_AMMO, 2, CANVAS.height - 4);
					} else {
						CONTEXT.fillText("ROCKETS: reloading", 2, CANVAS.height - 4);
					}

					if(FPS_COUNT >= 1000) {
						CONTEXT.fillText("FPS: " + TOTAL_FRAMES, 2,25);
						TEMP_TOTAL_FRAMERATE = TOTAL_FRAMES;
						TOTAL_FRAMES = 0;
						FPS_COUNT = 0;
					}

					PLAYER.draw();

					for (let i = 0; i < MISSILES.length; i++) {
						MISSILES[i].draw();
					}
					for (let i = 0; i < ENEMY_JETS.length; i++) {
						ENEMY_JETS[i].draw();
					}

					COUNT = 0;
					TOTAL_FRAMES += 1;
				}
				CONTEXT.fillText(Math.round(GLOBAL_TIMER), 1100, 25);
			 // document.getElementById("debug").innerHTML = Math.round(GLOBAL_TIMER);


			}

			var lastKnownPlayerPositionX = 0;
			var lastKnownPlayerPositionY = 0;
			function move() {
				lastKnownPlayerPositionX = PLAYER.x;
				lastKnownPlayerPositionY = PLAYER.y;

				switch (Boolean(Keys)) {
					case Keys.UP && Keys.LEFT: // Northeast 
						if ((isInsideBounds(PLAYER.x, (PLAYER.y - PLAYER.speed))) && (isInsideBounds((PLAYER.x - PLAYER.speed), PLAYER.y))) {
							PLAYER.y -= PLAYER.speed;
							PLAYER.x -= PLAYER.speed;
						}
					break;
					case Keys.UP && Keys.RIGHT: // Northwest
						if ((isInsideBounds(PLAYER.x, (PLAYER.y - PLAYER.speed))) && (isInsideBounds((PLAYER.x + PLAYER.speed), PLAYER.y))) {
							PLAYER.y -= PLAYER.speed;
							PLAYER.x += PLAYER.speed;
						}
					break;
					case Keys.DOWN && Keys.LEFT: // Southeast 
						if ((isInsideBounds(PLAYER.x, (PLAYER.y + PLAYER.speed))) && (isInsideBounds((PLAYER.x - PLAYER.speed), PLAYER.y))) { 
							PLAYER.y += PLAYER.speed;
							PLAYER.x -= PLAYER.speed;
						}
					break;
					case Keys.DOWN && Keys.RIGHT: // Southwest 
						if ((isInsideBounds(PLAYER.x, (PLAYER.y + PLAYER.speed))) && (isInsideBounds((PLAYER.x + PLAYER.speed), PLAYER.y))) { 
							PLAYER.y += PLAYER.speed;
							PLAYER.x += PLAYER.speed;
						}
					break;
					case Keys.UP: // North 
						if (isInsideBounds(PLAYER.x, (PLAYER.y - PLAYER.speed)))
							PLAYER.y -= PLAYER.speed;
					break;
					case Keys.LEFT: // East 
						if (isInsideBounds((PLAYER.x - PLAYER.speed), PLAYER.y))
							PLAYER.x -= PLAYER.speed;
					break;
					case Keys.RIGHT: // West 
						if (isInsideBounds((PLAYER.x + PLAYER.speed), PLAYER.y))
							PLAYER.x += PLAYER.speed;
					break;
					case Keys.DOWN: // South 
						if (isInsideBounds(PLAYER.x, (PLAYER.y + PLAYER.speed)))
							PLAYER.y += PLAYER.speed;
					break;
				}

				for (let i = 0; i < MISSILES.length; i++) {
					MISSILES[i].y -= 10;
				}
			}

			function isInsideBounds(x, y) {
				if (y > (CANVAS.height - PLAYER.height)) { // prevent down
					return 0;
				} else if (x < 0) {
					return 0;
				} else if (x > (CANVAS.width - PLAYER.width)) {
					return 0;
				} else if (y < 0) {
					return 0;
				} else {
					return 1;
				}
			}

		</script>
	</body> 
</html>
