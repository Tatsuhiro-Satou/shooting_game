<!DOCTYPE HTML>
<html>
	<head>
		<title>Shooting game</title>
		<style>

			.centeredElement {
			  position: fixed; /* or absolute */
			  top: 50%;
			  left: 50%;
			  margin-top: -350px; /* got to be 50% of canvas height */
			  margin-left: -600px; /* got to be 50% of canvas width */
			}

			p { 
				font-family: "Times New Roman";
				border:1px solid #d3d3d3; 
				padding-left: 0;
			   	padding-right: 0;
			   	margin-left: auto;
			   	margin-right: auto; 
				display: block;
			   	width: 800px;
			}

		</style>
	</head>
	<body>
		<canvas id="screen" class="centeredElement" width="1200" height="700"></canvas>
		<p id="debug">...</p>

		<script>
			const CANVAS = document.getElementById('screen');
			const CONTEXT = CANVAS.getContext('2d');
			CONTEXT.font = "30px Arial";
			var PLAYER;
			var now, dt, last = timestamp();
			var count = 0; // needs better name
			var fpsCount = 0;
			var totalFrames = 0;

			var KEYS = {
				UP: 87,
				LEFT: 65,
				RIGHT: 68,
				DOWN: 83,
				INFO: 73
			};

			document.getElementById("screen").style.backgroundColor = 'rgb(51, 171, 210)';
			window.addEventListener('keydown', keyHandler, false);

			function Player(initialX, initialY) {
				this.image = new Image(); 
				this.image.src = "resources/jet_sprite.png"
				this.width = 60;
				this.height = 60;
				this.x = initialX;
				this.y = initialY - this.height;
			}

			Player.prototype.getInfo = function() {
				return "x = " + this.x + ", y = " + this.y;
			};

			Player.prototype.draw = function() {
				CONTEXT.drawImage(PLAYER.image, this.x, this.y, this.width, this.height);
			};

			PLAYER = new Player((CANVAS.width / 2), CANVAS.height);

			window.onload = function() {
				init();
			}

			PLAYER.image.onload = function() {
				PLAYER.draw();
			}

			function init() {
				window.requestAnimationFrame(frame);
				CONTEXT.fillText("FPS:", 2, 25);
			}
			
			function frame() {
				now = timestamp();
				dt = now - last;
				last = now;
				update(dt);
				render(dt);
				window.requestAnimationFrame(frame);
			}

			function timestamp() {
				return window.performance && window.performance.now ? window.performance.now() : new Date().getTime();
			}

			function update() {
				fpsCount += dt;

				if(fpsCount >= 1000) {
					CONTEXT.clearRect(2, 0, 120, 30);
					CONTEXT.fillText("FPS: " + totalFrames, 2,25);
					totalFrames = 0;
					fpsCount = 0;
				}
			}


			function render(dt) {
				count += dt;

				if (count >= 0.06) {
					PLAYER.draw();

					count = 0;
					totalFrames += 1;
				}

				dt = 0;

			}

			function keyHandler(event) {
				CONTEXT.clearRect(PLAYER.x, PLAYER.y, PLAYER.width, PLAYER.height); 

				switch (event.keyCode) {
					case 87: // up
						if (checkBounds(PLAYER.x, (PLAYER.y - 10)))
							PLAYER.y -= 10;
					break;
					case 65: // left 
						if (checkBounds((PLAYER.x - 10), PLAYER.y))
							PLAYER.x -= 10;
					break;
					case 68: // right 
						if (checkBounds((PLAYER.x + 10), PLAYER.y))
							PLAYER.x += 10;
					break;
					case 83: // down 
						if (checkBounds(PLAYER.x, (PLAYER.y + 10)))
							PLAYER.y += 10;
					break;
					case 73: // info 
						alert(PLAYER.x + ", " + PLAYER.y);
					break;
				}
			}

			function checkBounds(x, y) {
				if (y > (CANVAS.height - PLAYER.height)) { // prevent down
					return 0;
				} else if (x < 0) {
					return 0;
				} else if (x > (CANVAS.width - PLAYER.width)) {
					return 0;
				} else if (y < 0) {
					return 0;
				} else {
					return 1;
				}
			}

		</script>
	</body> 
</html>
